:toc: left
:toclevels: 8
:nofooter:
:root: ..
:consumer: {root}/consumer
:producer: {root}/producer

= Spring Cloud Contract Workshops

This documentation will allow you to go through Spring Cloud Contract Workshops by completing
a series of tasks that will teach you the basic and more advanced concept behind Consumer Driven Contracts
and Spring Cloud Contract as such.

== Workshop setup

The repository mostly consists of pairs of `producer` and `consumer` applications that show
different use cases of Spring Cloud Contract. The initial state of the repository
is such that all the examples are working and the tests are passing. In order for you to prepare
the repository so it has only the basic pieces of code set up execute this Gradle command

[source,groovy]
----
./gradlew prepareForWorkshops
----

This command will remove most of the code / contracts / project setup so that you can start
with the workshops.

TIP: Whenever your lost - don't worry. It's enough to check what's there in the `master` branch
where all of the examples are ready and working.

TIP: You can start with any task - you don't have to do them in the provided order.

== Workshop resources

- Introduction to Consumer Driven Contracts
- Introduction to Spring Cloud Contract

== Workshop scenarios

We'll be in most cases trying to code the following scenarios:

image::images/beer_1.png[title="Positive beer selling via HTTP"]

{nbsp}
{nbsp}

image::images/beer_2.png[title="Negative beer selling via HTTP"]

{nbsp}
{nbsp}

image::images/msg_1.png[title="Positive age verification via messaging"]

{nbsp}
{nbsp}

image::images/msg_2.png[title="Negative age verification via messaging"]

{nbsp}
{nbsp}

== Workshop tasks

- Contracts on the producer side (in pairs)
  * simple DSL examples for HTTP & Messaging
- Contracts that lay in an external repository (in pairs)
  * simple DSL examples for HTTP & Messaging
- Spring Cloud Contract with Rest Docs (in pairs)
  * generating stubs using Rest Docs
  * generating contracts using Rest Docs
- Contracts on the producer side (single person teams)
  * more sophisticated DSL manipulations (regexs, code execution, referencing request from response)
  * working with stub and test matchers
  * contracts representing scenarios (stateful stubs)
  * creating a library with common code shareable between teams
  * stubbing out service discovery
  * stubs per consumer feature
  * classpath scanning
  * using JUnit rule
- Stub Runner Boot


=== Contracts on the producer side

Consumer Driven Contract is like TDD on the layer of architecture. Let's start with writing a test on the
consumer side.

- Open in your IDE the `consumer` project (either via Maven or Gradle)
- The code will fail to compile due to missing Spring Cloud Contract dependencies.
You have to add the Spring Cloud Starter Contract Stub Runner dependency.
<<stub_runner_dep,Show solution>>
- Open the `BeerControllerTest` test. Since CDC is like TDD we have 2 tests that describe our beer selling features.
- Now check the `BeerController` class. We're already providing some basic setup for you (in real TDD
example you'd have to code all of that yourself)
- Write the missing bodies in the `BeerControllerTest`. We want the responses to be `THERE YOU GO` and
`GET LOST` for the positive and negative scenario respectively.

== Solutions

=== [[stub_runner_dep]]Adding Spring Cloud Contract Stub Runner

[source,xml,indent=0,subs="verbatim,attributes",role="primary"]
.Maven
----
include::{consumer}/pom.xml[tags=stubrunner]
----

[source,groovy,indent=0,subs="verbatim,attributes",role="secondary"]
.Gradle
----
include::{consumer}/build.gradle[tags=stubrunner]
----